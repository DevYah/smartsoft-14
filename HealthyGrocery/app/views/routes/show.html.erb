<%= include_gon %>
<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>
<h1>Route Information</h1>
<br>
<p>
  <b>Route ID:</b>
  <%= @route.id %>
</p>

<p>
  <b>Orders No:</b>
  <% arr = [] %>
  <% @route.arrOfPoints.each do |points|%>
    <% arr.push(Order.find_by(coordinates: points).orderNo) %>
  <% end %> 
  <%= arr %>
</p>

<p>
  <b>Created at:</b>
  <%= @route.created_at %>
</p>

<p>
  <b>Shipment ID:</b>
  <%= @route.shipment_id %>
</p>

<p>
  <b>Truck ID:</b>
  <%= @route.truck_id %>
</p>
<br>
<br>
   
<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>
<div>   <div id="directions-panel" ></div>
</div>

<!--this script is responsible for viewing the map of the route  for testing the code just go to http://localhost:3000/ship_orders/gen-->
  <script type="text/javascript">
    var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();

function calcRoute() {

  var origin      = new google.maps.LatLng(gon.retailerLat,gon.retailerLng);
  var destination = new google.maps.LatLng(gon.retailerLat,gon.retailerLng);
 
 var arr = [];
 var arrOfPoints = gon.arrOfPoints;

  for (index = 0; index < arrOfPoints.length; ++index) {
      console.log(arrOfPoints[index]);
      var destination1 = new google.maps.LatLng(arrOfPoints[index][0]
, arrOfPoints[index][1]
);

arr.push({
          location: destination1,
          stopover:true});
    }
 
 var request = {
      origin:      origin,
      destination: destination,
      waypoints: arr,
      optimizeWaypoints: true,
      travelMode:  google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

calcRoute();

var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'map'}}, function(){
  directionsDisplay.setMap(handler.getMap());
});


directionsDisplay.setPanel(document.getElementById('directions-panel'));


</script>
<br>
<%= link_to 'Back', Shipment.find(@route.shipment_id) %>
