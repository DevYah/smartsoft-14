<%#
Author: Mohamed Saeed
#Team : 1
#View : Show Cart
#This view shows the user's cart, it shows the quantity of each item, the price of each item, the total cost of all items, and it also have the functionalities: show item, remove item, change quantity.
%>

<% if notice %>
<p id="notice"><%= notice %></p> <% end %>
<h2><%= current_member.first_name %>'s Shopping Cart</h2>

<% @cart.lineitems.each do |i| %> 
  <ul>
    <td><%= i.quantity %></td>
    <td>x </td>
    <td><%= i.item.name %></td>
    <td><%= link_to 'Show Item', item_path(i.item) %></td>
    <td><%= link_to 'Remove Item', i, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    <td><%= link_to 'Change quantity', edit_lineitem_path(i) %> </td>
    <td>Total price = <%= i.quantity*(i.item.price) %> </td>
    <% @cart.totalcost = @cart.totalcost+(i.quantity*(i.item.price)) %>
  </ul>
<% end %>
<td>Total Cost of All Items = <%= @cart.totalcost %> </td>
<hr/>
    <div class="container-fluid">
      <h2>Recommended tems</h2>
      <div class="row-fluid">
        <div id="slider-fluid-products" class="carousel slide">
          <div class="carousel-inner">
            <div class="active item">
              <ul class="thumbnails">
                <%@matching[0..3].each do |first_match|%>
                <li class="span3">
                  <div class="thumbnail">
                    <%= image_tag first_match.image.url%>
                    <div class="caption">
                      <h3><%= first_match.name%></h3>
                      <p>
                        <b>Price: </b>
                        <%=first_match.price%>
                        <br>
                        <b>Description: </b>
                        <%=first_match.description%>
                      </p>
                      <p>
                        <!--
                        goes with deskoy's add
                        <%= form_tag("../items/members_items_index/add", method: "post", multipart: true) do %>
                        <%= hidden_field_tag(:item, first_match.id ) %>
                        <%= text_field_tag :amount %>
                        <br>
                        <%= submit_tag "Buy now", :name => nil,class: "btn btn-primary"%>
                        <%end%>
                        goes with sakr's add
                        <%= button_to "Add to cart", lineitems_path(item_id: first_match.id), class: "btn btn-primary" %>
                         -->
                      </p>
                    </div>
                  </div>
                </li>
                <%end%>
              </ul>
            </div>
            <%(1..((@matching.count)/4)-1).each do |i|%>
            <div class="item">
              <ul class="thumbnails">
              <%start =i*4 %>
              <%ending =start+3%>
                <%@matching[start..ending].each do |match|%> 
                <li class="span3">
                  <div class="thumbnail">
                    <%= image_tag match.image.url%>
                    <div class="caption">
                      <h3><%=match.name%></h3>
                      <p>
                        <b>Price: </b>
                        <%=match.price%>
                        <br>
                        <b>Description: </b>
                        <%=match.description%>
                      </p>
                    </div>
                       <p>
                       <!--
                        goes with deskoy's add
                        <%= form_tag("../items/members_items_index/add", method: "post", multipart: true) do %>
                        <%= hidden_field_tag(:item, match.id ) %>
                        <%= text_field_tag :amount %>
                        <br>
                        <%= submit_tag "Buy now", :name => nil,class: "btn btn-primary"%>
                        <%end%>
                        goes with sakr's add
                        <%= button_to "Add to cart", lineitems_path(item_id: match.id), class: "btn btn-primary" %>
                         -->
                    </p>
                  </div>
                </li>
                <%end%>
              </ul>
            </div>
            <%end%>
          </div>
          <a class="left carousel-control" href="#slider-fluid-products" data-slide="prev">&lsaquo;</a>
          <a class="right carousel-control" href="#slider-fluid-products" data-slide="next">&rsaquo;</a>
        </div>
      </div>
    </div>
<br>
<%= link_to 'Edit', edit_cart_path(@cart) %> |
<%= link_to 'Back', carts_path %>
<!--link for the user in order to checkout the shopping cart to make the order:Author:mohamed lotfy Team:1-->
<%= link_to 'Checkout',{:controller  => 'orders', :action => 'new'}%>